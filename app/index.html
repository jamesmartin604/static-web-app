<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <title>Vanilla JavaScript App</title>
</head>
<body>
  <main>
    <h1>Vanilla JS App</h1>

    <div>
      <label for="msg">New message:</label>
      <input id="msg" type="text" placeholder="Type a message" />
      <button id="add">Add</button>
    </div>

    <h2>Messages</h2>
    <ul id="list"></ul>
  </main>

  <script>
    async function getMessages() {
      const res = await fetch('/api/messages');
      return await res.json();
    }

    async function createMessage(text) {
      const res = await fetch('/api/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      return await res.json();
    }

    async function show() {
      const list = document.querySelector('#list');
      list.innerHTML = '';

      const msgs = await getMessages();

      if (!msgs.length) {
        list.innerHTML = '<li>No messages yet</li>';
        return;
      }

      msgs.forEach(m => {
        const li = document.createElement('li');
        li.textContent = `${m.id}: ${m.text}`;
        list.appendChild(li);
      });
    }

    document.querySelector('#add').addEventListener('click', async () => {
      const text = document.querySelector('#msg').value.trim();
      if (!text) return;

      await createMessage(text);
      document.querySelector('#msg').value = '';
      show();
    });

    show();
  </script>
</body>
</html>
